var boardandarmies={"board":{"tiles":[[{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"*","number":1}]},{"terrain":"marsh","piecekeys":[{"armynumber":0,"power":"*","number":4}]},{"terrain":"desert","piecekeys":[{"armynumber":0,"power":"8","number":1}]},{"terrain":"desert","piecekeys":[{"armynumber":0,"power":"4","number":1}]},{"terrain":"town","piecekeys":[{"armynumber":1,"power":"5","number":1}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"*","number":3}]},{"terrain":"desert","piecekeys":[{"armynumber":1,"power":"*","number":1}]},{"terrain":"desert","piecekeys":[{"armynumber":1,"power":"3","number":2}]}],[{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"3","number":1}]},{"terrain":"marsh","piecekeys":[{"armynumber":0,"power":"*","number":2}]},{"terrain":"plains","piecekeys":[{"armynumber":0,"power":"8","number":2}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"6","number":0}]},{"terrain":"mountain","piecekeys":[{"armynumber":1,"power":"5","number":2}]},{"terrain":"water","piecekeys":[]},{"terrain":"desert","piecekeys":[{"armynumber":1,"power":"2","number":2}]},{"terrain":"mountain","piecekeys":[{"armynumber":1,"power":"5","number":0}]}],[{"terrain":"marsh","piecekeys":[{"armynumber":0,"power":"7","number":0}]},{"terrain":"marsh","piecekeys":[{"armynumber":0,"power":"3","number":0}]},{"terrain":"water","piecekeys":[]},{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"6","number":1}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"7","number":2}]},{"terrain":"plains","piecekeys":[{"armynumber":1,"power":"*","number":4}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"*","number":0}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"6","number":0}]}],[{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"4","number":2}]},{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"*","number":3}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"10","number":0}]},{"terrain":"town","piecekeys":[{"armynumber":0,"power":"6","number":2}]},{"terrain":"marsh","piecekeys":[{"armynumber":1,"power":"*","number":2}]},{"terrain":"marsh","piecekeys":[{"armynumber":1,"power":"8","number":2}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"7","number":1}]},{"terrain":"plains","piecekeys":[{"armynumber":1,"power":"C","number":0}]}],[{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"7","number":2}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"2","number":0}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"5","number":0}]},{"terrain":"plains","piecekeys":[{"armynumber":0,"power":"C","number":0}]},{"terrain":"marsh","piecekeys":[{"armynumber":1,"power":"9","number":0}]},{"terrain":"plains","piecekeys":[{"armynumber":1,"power":"8","number":1}]},{"terrain":"plains","piecekeys":[{"armynumber":1,"power":"8","number":0}]},{"terrain":"water","piecekeys":[]}],[{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"*","number":0}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"5","number":2}]},{"terrain":"marsh","piecekeys":[{"armynumber":0,"power":"2","number":2}]},{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"9","number":0}]},{"terrain":"marsh","piecekeys":[{"armynumber":1,"power":"2","number":1}]},{"terrain":"mountain","piecekeys":[{"armynumber":1,"power":"3","number":0}]},{"terrain":"mountain","piecekeys":[{"armynumber":1,"power":"1","number":0}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"7","number":0}]}],[{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"3","number":2}]},{"terrain":"town","piecekeys":[{"armynumber":0,"power":"8","number":0}]},{"terrain":"plains","piecekeys":[{"armynumber":0,"power":"4","number":0}]},{"terrain":"water","piecekeys":[]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"4","number":2}]},{"terrain":"mountain","piecekeys":[{"armynumber":1,"power":"6","number":2}]},{"terrain":"town","piecekeys":[{"armynumber":1,"power":"6","number":1}]},{"terrain":"mountain","piecekeys":[{"armynumber":1,"power":"4","number":0}]}],[{"terrain":"forest","piecekeys":[{"armynumber":0,"power":"1","number":0}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"5","number":1}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"7","number":1}]},{"terrain":"mountain","piecekeys":[{"armynumber":0,"power":"2","number":1}]},{"terrain":"marsh","piecekeys":[{"armynumber":1,"power":"10","number":0}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"4","number":1}]},{"terrain":"desert","piecekeys":[{"armynumber":1,"power":"3","number":1}]},{"terrain":"forest","piecekeys":[{"armynumber":1,"power":"2","number":0}]}]],"width":8,"height":8,"deathcurse":{"piecekeys":[]}},"armies":[{"side":"good","coordinates":[{"x":0,"y":0},{"x":4,"y":0}],"code":"28,84,93,66,87,10,40,44,50,53,59,69,80,90,100,63,81,7,19,41,47,56,62,71,78,83,89,92,95,102","pieces":{"1":[{"id":"95","armynumber":0,"power":"1","number":0,"x":7,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"2":[{"id":"93","armynumber":0,"power":"2","number":0,"x":4,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"59","armynumber":0,"power":"2","number":1,"x":7,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"92","armynumber":0,"power":"2","number":2,"x":5,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"3":[{"id":"90","armynumber":0,"power":"3","number":0,"x":2,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"56","armynumber":0,"power":"3","number":1,"x":1,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"89","armynumber":0,"power":"3","number":2,"x":6,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"4":[{"id":"87","armynumber":0,"power":"4","number":0,"x":6,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"53","armynumber":0,"power":"4","number":1,"x":0,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"19","armynumber":0,"power":"4","number":2,"x":3,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"5":[{"id":"84","armynumber":0,"power":"5","number":0,"x":4,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"50","armynumber":0,"power":"5","number":1,"x":7,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"83","armynumber":0,"power":"5","number":2,"x":5,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"6":[{"id":"80","armynumber":0,"power":"6","number":0,"x":1,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"81","armynumber":0,"power":"6","number":1,"x":2,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"47","armynumber":0,"power":"6","number":2,"x":3,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"7":[{"id":"10","armynumber":0,"power":"7","number":0,"x":2,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"44","armynumber":0,"power":"7","number":1,"x":7,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"78","armynumber":0,"power":"7","number":2,"x":4,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"8":[{"id":"40","armynumber":0,"power":"8","number":0,"x":6,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"7","armynumber":0,"power":"8","number":1,"x":0,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"41","armynumber":0,"power":"8","number":2,"x":1,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"9":[{"id":"71","armynumber":0,"power":"9","number":0,"x":5,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"10":[{"id":"69","armynumber":0,"power":"10","number":0,"x":3,"y":2,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"C":[{"id":"102","armynumber":0,"power":"C","number":0,"x":4,"y":3,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"*":[{"id":"28","armynumber":0,"power":"*","number":0,"x":5,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"66","armynumber":0,"power":"*","number":1,"x":0,"y":0,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"100","armynumber":0,"power":"*","number":2,"x":1,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"63","armynumber":0,"power":"*","number":3,"x":3,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"62","armynumber":0,"power":"*","number":4,"x":0,"y":1,"z":0,"alive":true,"deathcurse":false,"revealed":false}]}},{"side":"evil","coordinates":[{"x":0,"y":4},{"x":4,"y":4}],"code":"144,150,168,185,188,191,194,141,159,112,121,134,138,183,200,176,182,147,153,156,179,202,118,124,163,169,174,177,195,201","pieces":{"1":[{"id":"163","armynumber":1,"power":"1","number":0,"x":5,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"2":[{"id":"194","armynumber":1,"power":"2","number":0,"x":7,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"159","armynumber":1,"power":"2","number":1,"x":5,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"195","armynumber":1,"power":"2","number":2,"x":1,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"3":[{"id":"191","armynumber":1,"power":"3","number":0,"x":5,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"156","armynumber":1,"power":"3","number":1,"x":7,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"124","armynumber":1,"power":"3","number":2,"x":0,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"4":[{"id":"188","armynumber":1,"power":"4","number":0,"x":6,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"121","armynumber":1,"power":"4","number":1,"x":7,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"153","armynumber":1,"power":"4","number":2,"x":6,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"5":[{"id":"150","armynumber":1,"power":"5","number":0,"x":1,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"185","armynumber":1,"power":"5","number":1,"x":0,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"118","armynumber":1,"power":"5","number":2,"x":1,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"6":[{"id":"183","armynumber":1,"power":"6","number":0,"x":2,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"182","armynumber":1,"power":"6","number":1,"x":6,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"147","armynumber":1,"power":"6","number":2,"x":6,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"7":[{"id":"144","armynumber":1,"power":"7","number":0,"x":5,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"112","armynumber":1,"power":"7","number":1,"x":3,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"179","armynumber":1,"power":"7","number":2,"x":2,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"8":[{"id":"141","armynumber":1,"power":"8","number":0,"x":4,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"176","armynumber":1,"power":"8","number":1,"x":4,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"177","armynumber":1,"power":"8","number":2,"x":3,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"9":[{"id":"174","armynumber":1,"power":"9","number":0,"x":4,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"10":[{"id":"138","armynumber":1,"power":"10","number":0,"x":7,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"C":[{"id":"169","armynumber":1,"power":"C","number":0,"x":3,"y":7,"z":0,"alive":true,"deathcurse":false,"revealed":false}],"*":[{"id":"168","armynumber":1,"power":"*","number":0,"x":2,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"134","armynumber":1,"power":"*","number":1,"x":0,"y":6,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"200","armynumber":1,"power":"*","number":2,"x":3,"y":4,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"202","armynumber":1,"power":"*","number":3,"x":0,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false},{"id":"201","armynumber":1,"power":"*","number":4,"x":2,"y":5,"z":0,"alive":true,"deathcurse":false,"revealed":false}]}}]};
var io=require("socket.io").listen(3000);
var legendsconstructor=require("./legends.js");
var games=[];
io.sockets.on("connection",function(socket){
  socket.emit("gameslist",(function(){
    var returnvalue=[];
    for(var gameid=0;gameid<games.length;gameid++){
      returnvalue.push(games[gameid].armies);
    }
    return returnvalue;
  })());
  socket.on("creategame",function(data){
    var gameid=games.length;
    games.push(new legendsconstructor());
    games[gameid].armies=data.armies;
    games[gameid].board=data.board;
    socket.emit("gamecreated",gameid);
  });
  socket.on("joingame",function(data){
    if(typeof(games[data.gameid])=="undefined"){
      socket.emit("errormessage","game no longer exists");
    }
    else{
      socket.emit("init",{
        "board":games[data.gameid].board,
        "armies":games[data.gameid].armies
      });
    }
  });
  socket.on("pieceaction",function(data){
    if(typeof(games[data.gameid])=="undefined"){
      socket.emit("errormessage","game no longer exists");
    }
    else{
      games[data.gameid][data.action](data.armynumber,data.power,data.number,false,data.x,data.y);
      if(games[data.gameid].server.waitforreply){
        io.emit("pieceaction",data);
      }
      else{
        socket.broadcast.emit("pieceaction",data);
      }
    }
  });
  socket.on("disconnect",function(){});
});